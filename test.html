<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Banking Test</title>
<style>
body { margin:0; font-family: Arial; background:#f5f5f5; }
.header { padding:15px; text-align:center; color:#fff; font-size:22px; background:linear-gradient(90deg,#1e3e8e,#142c66); }
.container { display:flex; max-width:1000px; margin:auto; padding:15px; }
.questions-area { flex:3; background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
.nav-area { flex:1; margin-left:15px; }
.question-number { font-weight:bold; margin-bottom:10px; }
.options button { display:block; width:100%; text-align:left; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #1e3e8e; background:#f0f0f0; cursor:pointer; transition:0.3s; }
.options button.correct { background:#28a745; color:#fff; border:none; }
.options button.wrong { background:#dc3545; color:#fff; border:none; }
.options button:disabled { cursor: not-allowed; }
.nav-area button { width:100%; padding:8px; margin:5px 0; border-radius:8px; border:1px solid #1e3e8e; background:#fff; cursor:pointer; transition:0.3s; }
.nav-area button.current { background:#1e3e8e; color:#fff; }
.bottom-btn { margin-top:15px; padding:10px; width:100%; background:#1e3e8e; color:#fff; border:none; border-radius:8px; cursor:pointer; }
@media(max-width:768px){ .container { flex-direction:column; } .nav-area { margin-left:0; margin-top:15px; } }
</style>
</head>
<body>

<div class="header" id="testTitle">Loading Test...</div>

<div class="container">
  <div class="questions-area" id="questionsArea">
    Loading questions...
  </div>
  <div class="nav-area" id="navArea">
    <!-- Question navigator -->
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const testId = params.get('test');
const testTitle = params.get('title') || 'Test';
const currentUser = params.get('user') || '';
document.getElementById('testTitle').innerText = testTitle;

let questions = [];
let currentIndex = 0;
let answers = []; // store selected answers
let timerMinutes = 0;
let timerSeconds = 0;
let timerInterval;

function loadQuestions(){
  fetch('questions.json')
    .then(res=>res.json())
    .then(data=>{
      if(!data[testId]){
        document.getElementById('questionsArea').innerHTML='Test not found.';
        return;
      }
      questions = data[testId].questions;
      answers = Array(questions.length).fill(null);
      timerMinutes = questions.length; // 1 min per question
      timerSeconds = 0;
      createNav();
      showQuestion(0);
      startTimer();
    });
}

// Show question by index
function showQuestion(index){
  currentIndex = index;
  const q = questions[index];
  const qArea = document.getElementById('questionsArea');
  let html = `<div class="question-number">Question ${index+1} of ${questions.length}</div>`;
  html += `<div class="question-text">${q.q}</div>`;
  html += '<div class="options">';
  ['A','B','C','D'].forEach(opt=>{
    const selected = answers[index] === opt ? 'selected' : '';
    html += `<button onclick="selectOption('${opt}')" id="opt${opt}" ${answers[index]? 'disabled':''}>${opt}. ${q[opt]}</button>`;
  });
  html += '</div>';
  html += `<button class="bottom-btn" onclick="nextQuestion()">${index===questions.length-1?'Submit Test':'Next Question'}</button>`;
  qArea.innerHTML = html;
  updateNav();
}

// Option select
function selectOption(opt){
  answers[currentIndex] = opt;
  ['A','B','C','D'].forEach(o=>{
    const btn = document.getElementById('opt'+o);
    btn.disabled=true;
    if(o===questions[currentIndex].answer) btn.classList.add('correct');
    else if(o===opt) btn.classList.add('wrong');
  });
  updateNav();
}

// Next question
function nextQuestion(){
  if(currentIndex < questions.length-1){
    showQuestion(currentIndex+1);
  }else{
    submitTest();
  }
}

// Create right-side navigator
function createNav(){
  const nav = document.getElementById('navArea');
  nav.innerHTML='';
  questions.forEach((q,i)=>{
    const btn = document.createElement('button');
    btn.innerText = i+1;
    btn.onclick = ()=>showQuestion(i);
    nav.appendChild(btn);
  });
}

// Highlight current question in navigator
function updateNav(){
  const nav = document.getElementById('navArea');
  Array.from(nav.children).forEach((btn,i)=>{
    btn.classList.toggle('current', i===currentIndex);
    if(answers[i]) btn.style.background='#1e3e8e'; else btn.style.background='#fff';
  });
}

// Timer
function startTimer(){
  const totalSeconds = timerMinutes*60+timerSeconds;
  let remaining = totalSeconds;
  timerInterval = setInterval(()=>{
    const min = Math.floor(remaining/60);
    const sec = remaining%60;
    document.getElementById('testTitle').innerText = `${testTitle} — Time Left: ${min}:${sec<10?'0'+sec:sec}`;
    remaining--;
    if(remaining<0){
      clearInterval(timerInterval);
      submitTest();
    }
  },1000);
}

// Submit Test
function submitTest(){
  clearInterval(timerInterval);
  // Calculate score
  let score = 0;
  questions.forEach((q,i)=>{
    if(answers[i]===q.answer) score++;
  });
  const percent = Math.round(score/questions.length*100);

  // Show results
  const qArea = document.getElementById('questionsArea');
  let html = `<h3>Test Completed</h3>`;
  html += `<p>Your Score: ${score} / ${questions.length} (${percent}%)</p>`;
  html += `<button class="bottom-btn" onclick="window.location.href='mocktests.html'">← Back to Mock Tests</button>`;
  qArea.innerHTML = html;

  // Send results to Google Sheets
  sendResultsToGoogleSheet(testId,testTitle,percent);
}

// Send results to Google Form (replace entry IDs)
function sendResultsToGoogleSheet(testId, title, score){
  if(!currentUser) return;
  const formUrl = "https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse"; // Replace
  const formData = new FormData();
  formData.append('entry.1111111111', currentUser); // Mobile
  formData.append('entry.2222222222', title);       // Test Title
  formData.append('entry.3333333333', score);       // Score

  fetch(formUrl,{method:'POST',mode:'no-cors',body:formData})
    .then(()=>console.log('Result sent to Google Sheets'))
    .catch(err=>console.error(err));
}

// Initialize
loadQuestions();
</script>

</body>
</html>
